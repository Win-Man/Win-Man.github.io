<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Win-Man&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Win-Man&#39;s Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Win-Man&#39;s Blog">

<link rel="canonical" href="http://yoursite.com/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'default'
  };
</script>

  <title>Win-Man's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Win-Man's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/25/NFS总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/08/25/NFS总结/" class="post-title-link" itemprop="url">NFS总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-08-25 16:13:04" itemprop="dateCreated datePublished" datetime="2017-08-25T16:13:04+08:00">2017-08-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是NFS，为什么要NFS"><a href="#什么是NFS，为什么要NFS" class="headerlink" title="什么是NFS，为什么要NFS"></a>什么是NFS，为什么要NFS</h2><p>NFS（Network File System）这个网络文件系统，最大的功能是通过网络，使得在不同的机器之间共享文件。通过NFS可以将另一台机器的某个目录挂载到本机的某个目录下，在使用的时候挂载过来的目录就像在本地一样。极大的方便了多台服务器之间的文件共享。</p>
<h2 id="什么是RPC"><a href="#什么是RPC" class="headerlink" title="什么是RPC"></a>什么是RPC</h2><p>在提到NFS服务的时候，都会提到RPC服务，那么什么是RPC服务，为什么需要RPC服务呢。<br>首先RPC是Remote Procedure Call的缩写，及远程过程调用。其次关于为什么要RPC服务是因为，NFS服务在启动的时候对于端口的选择是随机的，NFS在启动的时候回随机选择小于1024的端口进行数据的传输。那么在客户端连接到NFS服务器的时候，怎么知道应该通过哪个端口进行连接呢。这个时候就需要RPC服务出现了，RPC的主要功能就是记录每个NFS服务所对应的端口号，并将对应的端口号发送给客户端，客户端根据获得的端口号进行连接。<br><strong>客户端连接NFS服务的过程：</strong></p>
<ol>
<li>客户端首先向NFS服务所在的服务器的RPC服务发起请求，RPC服务的端口固定为111</li>
<li>RPC服务在接收到客户端的请求之后，找到注册的NFS服务所对应的端口号，并将端口号发送给客户端</li>
<li>客户端根据获取到NFS端口号进行连接</li>
</ol>
<h2 id="配置NFS步骤"><a href="#配置NFS步骤" class="headerlink" title="配置NFS步骤"></a>配置NFS步骤</h2><ul>
<li>环境介绍<ul>
<li>CentOS6.6</li>
</ul>
</li>
</ul>
<h3 id="NFS主要软件结构"><a href="#NFS主要软件结构" class="headerlink" title="NFS主要软件结构"></a>NFS主要软件结构</h3><ul>
<li>/etc/exports NFS的主要配置文件，在该文件中定义NFS输出的目录、权限等属性</li>
<li>/usr/sbin/exportfs 管理NFS共享资源的命令，在NFS的server端使用</li>
<li>/usr/sbin/showmount 查询NFS共享资源的命令，在client端使用</li>
<li>/var/lib/nfs/etab NFS的日志文件，记录了NFS共享出来的目录的完整权限设置值</li>
<li>/var/lib/nfs/xtab NFS连接信息的日志文件，记录了曾经链接到此NFS服务器的相关客户端的数据</li>
</ul>
<h3 id="etc-exports配置文件介绍"><a href="#etc-exports配置文件介绍" class="headerlink" title="/etc/exports配置文件介绍"></a>/etc/exports配置文件介绍</h3><p>配置文件中的格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;输出目录&gt; [客户端1(权限)] [客户端2(权限)] ...</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>输出目录<br>指定共享的文件目录</p>
</li>
<li><p>客户端<br>指定可以访问共享资源的客户端</p>
<ul>
<li>指定IP的方式：192.168.1.1</li>
<li>指定网段的方式 192.168.1.0/24或者192.168.1.0/255.255.255.0</li>
<li>指定主机名的方式 node1，但是这个主机名必须在记录在/etc/hosts文件内，需要能解析到对应的ip</li>
<li>通配符的方式 <em>表示所有的主机，node</em>主机名通配</li>
</ul>
</li>
<li><p>权限</p>
<ul>
<li>rw/ro 指定文件是可读写（read-write）的还是只读（read-only）的</li>
<li>sync/async 对目录中的数据进行更改的话，更改会同步写到硬盘还是只写到内存直接写到硬盘</li>
<li>no_root_squash 当客户端使用root账户连接的时候，不转化为匿名用户</li>
<li>root_squash 当客户端使用root账户连接的会后，转化为匿名用户</li>
<li>all_squash 当客户端连接的时候，无论使用什么用户进行连接，都会被转换为匿名用户</li>
<li>anonuid 指定匿名用户的UID</li>
<li>anongid 指定匿名用户的GID</li>
</ul>
</li>
</ul>
<h3 id="NFS-server端配置"><a href="#NFS-server端配置" class="headerlink" title="NFS server端配置"></a>NFS server端配置</h3><ul>
<li><p>检查服务器是否安装了nfs-util和rpcbind两个包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@d146bbc8-94a2-42c4-8eaa-3fb3264fd176 ~]# rpm -qa | grep nfs</span><br><span class="line">nfs-utils-1.2.3-54.el6.x86_64</span><br><span class="line">nfs-utils-lib-1.1.5-9.el6.x86_64</span><br><span class="line">[root@d146bbc8-94a2-42c4-8eaa-3fb3264fd176 ~]# rpm -qa | grep rpcbind</span><br><span class="line">rpcbind-0.2.0-11.el6.x86_64</span><br></pre></td></tr></table></figure>
</li>
<li><p>填写/etc/exports配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /nfs/&#123;test1,test2,test3,test4,test5&#125;</span><br><span class="line">vim /etc/exports</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/nfs.png" alt><br>exports配置文件中都有默认权限配置，如果我们想查看默认的配置是什么，可以查看<code>/var/lib/nfs/etab</code>文件，该文件中完整的记录了NFS共享资源的所有配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/nfs/test2	10.10.30.247(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)</span><br><span class="line">/nfs/test1	10.10.30.247(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)</span><br><span class="line">/nfs/test3	10.10.30.0/24(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)</span><br><span class="line">/nfs/test2	*(ro,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,anonuid=65534,anongid=65534)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>启动RPC服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@d146bbc8-94a2-42c4-8eaa-3fb3264fd176 ~]# /etc/init.d/rpcbind start</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动NFS服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@d146bbc8-94a2-42c4-8eaa-3fb3264fd176 ~]# /etc/init.d/nfs start</span><br><span class="line">Starting NFS services:                                     [  OK  ]</span><br><span class="line">Starting NFS quotas:                                       [  OK  ]</span><br><span class="line">Starting NFS mountd:                                       [  OK  ]</span><br><span class="line">Starting NFS daemon:                                       [  OK  ]</span><br><span class="line">Starting RPC idmapd:                                       [  OK  ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改/etc/exports文件<br>如果我们在启动NFS服务之后，又修改了 <code>exports</code> 文件的话怎么办，是不是需要重新启动NFS服务才能使的这些配置生效，答案当然是否定的，这样多麻烦。我们有 <code>exportfs</code> 命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">exportfs [-aruv]</span><br><span class="line"></span><br><span class="line">options:</span><br><span class="line"> -a:全部挂载或卸载</span><br><span class="line"> -r:重新挂载/etc/exports配置文件中的信息</span><br><span class="line"> -u:卸载某一目录</span><br><span class="line"> -v:将内容显示输出</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="client端配置"><a href="#client端配置" class="headerlink" title="client端配置"></a>client端配置</h3><ul>
<li>通过showmount命令查看NFS共享资源的情况<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# showmount -e 10.10.30.250</span><br><span class="line">Export list for 10.10.30.250:</span><br><span class="line">/nfs/test3 10.10.30.0/24</span><br><span class="line">/nfs/test2 (everyone)</span><br><span class="line">/nfs/test1 10.10.30.247</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">showmount [-ae] [hostname|IP]</span><br><span class="line"></span><br><span class="line">options:</span><br><span class="line"> -a:显示当前主机与客户端的NFS连接情况</span><br><span class="line"> -e:显示指定NFS服务器的共享资源情况</span><br></pre></td></tr></table></figure>
<ul>
<li><p>挂载NFS目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mkdir -p /nfs/local/&#123;test1,test2,test3&#125;</span><br><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mount 10.10.30.250:/nfs/test1 /nfs/local/test1</span><br><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mount 10.10.30.250:/nfs/test2 /nfs/local/test2</span><br><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mount 10.10.30.250:/nfs/test3 /nfs/local/test3</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看挂载情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/VolGroup-root</span><br><span class="line">                       50G  5.3G   42G  12% /</span><br><span class="line">tmpfs                 1.9G     0  1.9G   0% /dev/shm</span><br><span class="line">/dev/vda1             488M   31M  432M   7% /boot</span><br><span class="line">/dev/sda               20G   33M   20G   1% /data</span><br><span class="line">10.10.30.250:/nfs/test1</span><br><span class="line">                       50G  5.3G   42G  12% /nfs/local/test1</span><br><span class="line">10.10.30.250:/nfs/test2</span><br><span class="line">                       50G  5.3G   42G  12% /nfs/local/test2</span><br><span class="line">10.10.30.250:/nfs/test3</span><br><span class="line">                       50G  5.3G   42G  12% /nfs/local/test3</span><br><span class="line">[root@6a192e7f-a43d-4b57-9573-ca740e3b5f0d ~]# mount</span><br><span class="line">/dev/mapper/VolGroup-root on / type ext4 (rw)</span><br><span class="line">proc on /proc type proc (rw)</span><br><span class="line">sysfs on /sys type sysfs (rw)</span><br><span class="line">devpts on /dev/pts type devpts (rw,gid=5,mode=620)</span><br><span class="line">tmpfs on /dev/shm type tmpfs (rw)</span><br><span class="line">/dev/vda1 on /boot type ext4 (rw)</span><br><span class="line">none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)</span><br><span class="line">/dev/sda on /data type xfs (rw,nouuid)</span><br><span class="line">sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)</span><br><span class="line">10.10.30.250:/nfs/test1 on /nfs/local/test1 type nfs (rw,vers=4,addr=10.10.30.250,clientaddr=10.10.30.247)</span><br><span class="line">10.10.30.250:/nfs/test2 on /nfs/local/test2 type nfs (rw,vers=4,addr=10.10.30.250,clientaddr=10.10.30.247)</span><br><span class="line">10.10.30.250:/nfs/test3 on /nfs/local/test3 type nfs (rw,vers=4,addr=10.10.30.250,clientaddr=10.10.30.247)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="NFS文件访问权限设置"><a href="#NFS文件访问权限设置" class="headerlink" title="NFS文件访问权限设置"></a>NFS文件访问权限设置</h2><p>我们知道在Linux系统中的文件，都有访问权限，可以指定用户访问，那么我通过NFS访问文件权限是如何设定的呢。比如我再NFS server上有一个文件的属主与属组都是gangshen,那我再client端普通用户user1访问这个文件，可以做修改吗？如果是使用root用户访问这个文件，可以做修改吗？<br>NFS文件系统的权限访问的原则是：<strong>服务器端会以客户端的用户UID与GID等身份来尝试读取服务器端的文件系统</strong><br>以下是NFS是如何判断是否一个文件可写的步骤:</p>
<ol>
<li>客户端以user1这个账户访问NFS目录，实际是以client端的user1的UID以及GID进行访问的</li>
<li>NFS server收到客户端访问请求中的UID、GID，并根据这个UID在server端所在的服务器找到相应的用户，以该用户的权限进行访问</li>
<li>如果找不到对应UID的用户，则NFS server端会将连接的身份转换为匿名用户的连接</li>
<li>根据/etc/exports配置文件判断该目录是否有写入权限<br>只有在满足：1、用户有写入权限 2、exports设置为有写入权限 3、文件具有写入权限 这三点之后，客户端才可以写入NFS是共享目录。</li>
</ol>
<p>根据上述步骤的话，可以想到一种情况，如果我client端是通过root账户连接的，那我是不是对所有的文件具有可读、可写权限。这个的话，就需要重新来看下/etc/exports这个配置文件了。在exports文件中，设定权限的时候可以指定no_root_squash、root_squash、all_squash，这三个就是控制，我client连接上来的用户，最终在server端会以哪个用户进行访问。默认情况下是设置为root_squash，就是说如果client以root用户连接上来的话，server端会将该用户转换为匿名用户进行访问。很明显no_root_squash这个选项就是说不转换成匿名用户，all_squash这个选项是指定无论client用什么账户连接上来，都会被转换成匿名用户。</p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/在Linux下磁盘分区、创建文件系统、挂载/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/11/在Linux下磁盘分区、创建文件系统、挂载/" class="post-title-link" itemprop="url">在Linux下磁盘分区、创建文件系统、挂载</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-11 14:52:22" itemprop="dateCreated datePublished" datetime="2017-07-11T14:52:22+08:00">2017-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>学习Linux的时候，避不开的就是需要学习Linux中的分区。学习Linux的分区，有很多概念性的东西需要学习，比如分区类型啊，文件系统类型啊…等等，对于我来说，并不是很喜欢这种概念性的东西，上来一大段文字对于我一点都不友好。所以整理了一篇笔记，记录怎么对Linux中的磁盘进行分区、创建文件系统以及挂载。首先能实操使用，接着再慢慢理解其中的内容。</p>
<h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><p>操作系统：CentOS6.6</p>
<h2 id="命令介绍"><a href="#命令介绍" class="headerlink" title="命令介绍"></a>命令介绍</h2><h3 id="分区命令"><a href="#分区命令" class="headerlink" title="分区命令"></a>分区命令</h3><h4 id="fdisk-分区"><a href="#fdisk-分区" class="headerlink" title="fdisk 分区"></a>fdisk 分区</h4><p>fdisk可用于查看硬盘分区情况，也可以使用fdisk进行分区。<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-b SECTOR_SIZE：指定每个分区大小</span><br><span class="line">-l:列出指定硬盘的分区情况</span><br><span class="line">-s PARTITION:输出指定分区的大小，单位为块</span><br><span class="line">-u:在列出硬盘分区情况的时候，使用块为单位列出分区大小而不是以柱面为单位</span><br><span class="line">-v:显示版本信息</span><br></pre></td></tr></table></figure></p>
<p><strong>子选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p:print，显示已有分区</span><br><span class="line">n:new，创建</span><br><span class="line">d:delete，删除</span><br><span class="line">w:write，写入磁盘并退出</span><br><span class="line">q:quit，放弃更新并退出</span><br><span class="line">m:获取帮助</span><br><span class="line">l:列表所分区id</span><br><span class="line">t:调整分区id</span><br></pre></td></tr></table></figure></p>
<h4 id="partx-识别分区"><a href="#partx-识别分区" class="headerlink" title="partx 识别分区"></a>partx 识别分区</h4><p><em>**选项：</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-a:通知内核重新读取硬盘分区表</span><br><span class="line">-d:删除分区硬盘分区表信息</span><br><span class="line">-l:列出分区</span><br><span class="line">--type YTPE:指定分区类型</span><br><span class="line">--nr M-N:指定分区范围</span><br></pre></td></tr></table></figure></p>
<h3 id="创建文件系统命令"><a href="#创建文件系统命令" class="headerlink" title="创建文件系统命令"></a>创建文件系统命令</h3><h4 id="mkfs-创建文件系统"><a href="#mkfs-创建文件系统" class="headerlink" title="mkfs 创建文件系统"></a>mkfs 创建文件系统</h4><p><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-t TYPE:指定穿件的文件系统类型</span><br><span class="line">-v:显示版本信息</span><br><span class="line">-c:创建文件系统之前，先检查分区是否存在坏块</span><br></pre></td></tr></table></figure></p>
<h4 id="mkswap-创建交换分区"><a href="#mkswap-创建交换分区" class="headerlink" title="mkswap 创建交换分区"></a>mkswap 创建交换分区</h4><p><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-c:创建交换分区之前，先检查分区是否存在坏块</span><br><span class="line">-f:强制执行</span><br></pre></td></tr></table></figure></p>
<h3 id="挂载命令"><a href="#挂载命令" class="headerlink" title="挂载命令"></a>挂载命令</h3><h4 id="mount-挂载分区"><a href="#mount-挂载分区" class="headerlink" title="mount 挂载分区"></a>mount 挂载分区</h4><p>mount [-fnrsvw] [-t vfstype] [-o options] device dir<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-t vsftype:指定要挂载的设备上的文件系统类型</span><br><span class="line">-r ：readonly，只读挂载</span><br><span class="line">-w：read and write，读写挂载</span><br><span class="line">-n：不更新/etc/fstab</span><br><span class="line">-a：自动挂载所有支持自动挂载的设备（定义在了/etc/fstab文件中，且挂载选项中有“自动挂载”功能）</span><br><span class="line">-L &apos;LABEL&apos;：以卷标指定挂载设备</span><br><span class="line">-U &apos;UUID&apos;：以UUID指定要挂载的设备</span><br><span class="line">-B，--bind：绑定目录到另一个目录上</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-o options:挂载文件系统的选项</span><br><span class="line">async：异步模式</span><br><span class="line">sync：同步模式</span><br><span class="line">atime/noatime:包含目录和文件</span><br><span class="line">diratime/nodiratime:目录的访问时间戳</span><br><span class="line">auto/noauto:是否支持自动挂载</span><br><span class="line">exec/noexec:是否支持将文件系统上的应用程序运行为进程</span><br><span class="line">dev/nodev:是否支持在此文件系统上使用设备</span><br><span class="line">suid/nosuid；</span><br><span class="line">remount：重新挂载</span><br><span class="line">ro：只读挂载</span><br><span class="line">rw：读写挂载</span><br><span class="line">user/nouser:是否允许普通用户挂载此设备</span><br><span class="line">acl：启用此文件系统上acl功能</span><br><span class="line">defaults：rw,suid,dev,exec,auto,nouser,and async</span><br></pre></td></tr></table></figure></p>
<h4 id="umount-卸载分区"><a href="#umount-卸载分区" class="headerlink" title="umount 卸载分区"></a>umount 卸载分区</h4><p>umount [-dflnrv] {dir|device}…<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-a：卸除/etc/mtab中记录的所有文件系统；</span><br><span class="line">-h：显示帮助；</span><br><span class="line">-n：卸除时不要将信息存入/etc/mtab文件中；</span><br><span class="line">-r：若无法成功卸除，则尝试以只读的方式重新挂入文件系统；</span><br><span class="line">-t&lt;文件系统类型&gt;：仅卸除选项中所指定的文件系统；</span><br><span class="line">-v：执行时显示详细的信息；</span><br><span class="line">-V：显示版本信息。</span><br></pre></td></tr></table></figure></p>
<h4 id="swapon-启用交换分区"><a href="#swapon-启用交换分区" class="headerlink" title="swapon 启用交换分区"></a>swapon 启用交换分区</h4><p>swapon [-f] [-p priority] [-v] specialfile…<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-a ：激活所有的交换分区</span><br><span class="line">-p PRIORITY：指定优先级</span><br></pre></td></tr></table></figure></p>
<h4 id="swapoff-禁用交换分区"><a href="#swapoff-禁用交换分区" class="headerlink" title="swapoff 禁用交换分区"></a>swapoff 禁用交换分区</h4><p>swapoff [-v] specialfile…<br><strong>选项：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a：禁用所有的交换分区</span><br></pre></td></tr></table></figure></p>
<h2 id="步骤介绍"><a href="#步骤介绍" class="headerlink" title="步骤介绍"></a>步骤介绍</h2><h3 id="普通分区从创建以及挂载"><a href="#普通分区从创建以及挂载" class="headerlink" title="普通分区从创建以及挂载"></a>普通分区从创建以及挂载</h3><ul>
<li><p>查看硬盘以及分区情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# lsblk</span><br><span class="line">NAME                       MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sr0                         11:0    1  4.3G  0 rom  </span><br><span class="line">sda                          8:0    0   20G  0 disk </span><br><span class="line">├─sda1                       8:1    0  500M  0 part /boot</span><br><span class="line">└─sda2                       8:2    0 19.5G  0 part </span><br><span class="line">  ├─vg_sgpc-lv_root (dm-0) 253:0    0 17.6G  0 lvm  /</span><br><span class="line">  └─vg_sgpc-lv_swap (dm-1) 253:1    0    2G  0 lvm  [SWAP]</span><br><span class="line">sdb                          8:16   0   20G  0 disk </span><br><span class="line">[root@sg-pc /]# fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</span><br><span class="line">         switch off the mode (command &apos;c&apos;) and change display units to</span><br><span class="line">         sectors (command &apos;u&apos;).</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x179a39d6</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line"></span><br><span class="line">Command (m for help):</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用fdisk对/dev/sdb硬盘划分分区，划分3个主分区，每个主分区5G大小，并且划分一个扩展分区，4G大小。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</span><br><span class="line">         switch off the mode (command &apos;c&apos;) and change display units to</span><br><span class="line">         sectors (command &apos;u&apos;).</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1</span><br><span class="line">First cylinder (1-2610, default 1): </span><br><span class="line">Using default value 1</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-2610, default 2610): +5G</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 2</span><br><span class="line">First cylinder (655-2610, default 655): </span><br><span class="line">Using default value 655</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (655-2610, default 2610): +5G</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 3</span><br><span class="line">First cylinder (1309-2610, default 1309): </span><br><span class="line">Using default value 1309</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1309-2610, default 2610): +5G</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">e</span><br><span class="line">Selected partition 4</span><br><span class="line">First cylinder (1963-2610, default 1963): </span><br><span class="line">Using default value 1963</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1963-2610, default 2610): +2610</span><br><span class="line">Value out of range.</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1963-2610, default 2610): </span><br><span class="line">Using default value 2610</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x179a39d6</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         654     5253223+  83  Linux</span><br><span class="line">/dev/sdb2             655        1308     5253255   83  Linux</span><br><span class="line">/dev/sdb3            1309        1962     5253255   83  Linux</span><br><span class="line">/dev/sdb4            1963        2610     5205060    5  Extended</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">First cylinder (1963-2610, default 1963): </span><br><span class="line">Using default value 1963</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1963-2610, default 2610): +2G </span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x179a39d6</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         654     5253223+  83  Linux</span><br><span class="line">/dev/sdb2             655        1308     5253255   83  Linux</span><br><span class="line">/dev/sdb3            1309        1962     5253255   83  Linux</span><br><span class="line">/dev/sdb4            1963        2610     5205060    5  Extended</span><br><span class="line">/dev/sdb5            1963        2224     2104483+  83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>
</li>
<li><p>将新划分的分区加载到硬盘分区表中，并查看分区状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# partx -a /dev/sdb</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 1</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 2</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 3</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 4</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition 5</span><br><span class="line">[root@sg-pc /]# cat /proc/partitions </span><br><span class="line">major minor  #blocks  name</span><br><span class="line"></span><br><span class="line">   8        0   20971520 sda</span><br><span class="line">   8        1     512000 sda1</span><br><span class="line">   8        2   20458496 sda2</span><br><span class="line">   8       16   20971520 sdb</span><br><span class="line">   8       17    5253223 sdb1</span><br><span class="line">   8       18    5253255 sdb2</span><br><span class="line">   8       19    5253255 sdb3</span><br><span class="line">   8       20          1 sdb4</span><br><span class="line">   8       21    2104483 sdb5</span><br><span class="line"> 253        0   18391040 dm-0</span><br><span class="line"> 253        1    2064384 dm-1</span><br></pre></td></tr></table></figure>
</li>
<li><p>为分区创建文件系统，这边就选择/dev/sdb1分区作为示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# mkfs -t ext4 -L &apos;backup&apos; /dev/sdb1</span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem label=backup</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=4096 (log=2)</span><br><span class="line">Fragment size=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">328656 inodes, 1313305 blocks</span><br><span class="line">65665 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=1346371584</span><br><span class="line">41 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8016 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">	32768, 98304, 163840, 229376, 294912, 819200, 884736</span><br><span class="line"></span><br><span class="line">Writing inode tables: done                            </span><br><span class="line">Creating journal (32768 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br><span class="line"></span><br><span class="line">This filesystem will be automatically checked every 25 mounts or</span><br><span class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过blkid命令，可以查看硬盘设备的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# blkid</span><br><span class="line">/dev/sda1: UUID=&quot;5e605252-9e26-4ca0-b353-e3e6028bc6ca&quot; TYPE=&quot;ext4&quot; </span><br><span class="line">/dev/sda2: UUID=&quot;drR3Sx-Ht8g-nGFi-2vR3-CD3z-qSjY-PUXiye&quot; TYPE=&quot;LVM2_member&quot; </span><br><span class="line">/dev/mapper/vg_sgpc-lv_root: UUID=&quot;9ccc9289-ada6-48b8-82f1-42d2f7edba06&quot; TYPE=&quot;ext4&quot; </span><br><span class="line">/dev/mapper/vg_sgpc-lv_swap: UUID=&quot;9c4c6c97-b20d-4548-a249-8d98f6b400f1&quot; TYPE=&quot;swap&quot; </span><br><span class="line">/dev/sdb1: LABEL=&quot;backup&quot; UUID=&quot;4a7b5acb-fc24-446d-b9e0-a14afbe171d9&quot; TYPE=&quot;ext4&quot; </span><br><span class="line">/dev/sdb2: LABEL=&quot;myswap&quot; UUID=&quot;79f07b7d-c504-43c2-9e0f-87bee77d59b9&quot; TYPE=&quot;swap&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将创建完文件系统的分区挂载指定目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# mkdir /backup</span><br><span class="line">[root@sg-pc /]# mount /dev/sdb1 /backup/</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查分区挂载情况<br><img src="http://oc4wmeyj8.bkt.clouddn.com/%E5%88%86%E5%8C%BA%E6%8C%82%E8%BD%BD%E6%83%85%E5%86%B5.png" alt><br>可以看到/dev/sdb1已经被挂载到/backup目录下了。</p>
</li>
</ul>
<h3 id="交换分区的创建与挂载"><a href="#交换分区的创建与挂载" class="headerlink" title="交换分区的创建与挂载"></a>交换分区的创建与挂载</h3><p>交换分区的创建与挂载步骤与普通分区一致，也是先划分分区，然后在分区上创建文件系统，接着是激活交换分区。因为交换分区与普通分区有一点不同，需要先调整分区的分区ID。</p>
<ul>
<li><p>将/dev/sdb2分区作为交换分区，首先需要修改/dev/sdb2分区的分区ID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">WARNING: DOS-compatible mode is deprecated. It&apos;s strongly recommended to</span><br><span class="line">         switch off the mode (command &apos;c&apos;) and change display units to</span><br><span class="line">         sectors (command &apos;u&apos;).</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes</span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x179a39d6</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         654     5253223+  83  Linux</span><br><span class="line">/dev/sdb2             655        1308     5253255   83  Linux</span><br><span class="line">/dev/sdb3            1309        1962     5253255   83  Linux</span><br><span class="line">/dev/sdb4            1963        2610     5205060    5  Extended</span><br><span class="line">/dev/sdb5            1963        2224     2104483+  83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help): l</span><br><span class="line"></span><br><span class="line"> 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris        </span><br><span class="line"> 1  FAT12           39  Plan 9          82  Linux swap / So c1  DRDOS/sec (FAT-</span><br><span class="line"> 2  XENIX root      3c  PartitionMagic  83  Linux           c4  DRDOS/sec (FAT-</span><br><span class="line"> 3  XENIX usr       40  Venix 80286     84  OS/2 hidden C:  c6  DRDOS/sec (FAT-</span><br><span class="line"> 4  FAT16 &lt;32M      41  PPC PReP Boot   85  Linux extended  c7  Syrinx         </span><br><span class="line"> 5  Extended        42  SFS             86  NTFS volume set da  Non-FS data    </span><br><span class="line"> 6  FAT16           4d  QNX4.x          87  NTFS volume set db  CP/M / CTOS / .</span><br><span class="line"> 7  HPFS/NTFS       4e  QNX4.x 2nd part 88  Linux plaintext de  Dell Utility   </span><br><span class="line"> 8  AIX             4f  QNX4.x 3rd part 8e  Linux LVM       df  BootIt         </span><br><span class="line"> 9  AIX bootable    50  OnTrack DM      93  Amoeba          e1  DOS access     </span><br><span class="line"> a  OS/2 Boot Manag 51  OnTrack DM6 Aux 94  Amoeba BBT      e3  DOS R/O        </span><br><span class="line"> b  W95 FAT32       52  CP/M            9f  BSD/OS          e4  SpeedStor      </span><br><span class="line"> c  W95 FAT32 (LBA) 53  OnTrack DM6 Aux a0  IBM Thinkpad hi eb  BeOS fs        </span><br><span class="line"> e  W95 FAT16 (LBA) 54  OnTrackDM6      a5  FreeBSD         ee  GPT            </span><br><span class="line"> f  W95 Ext&apos;d (LBA) 55  EZ-Drive        a6  OpenBSD         ef  EFI (FAT-12/16/</span><br><span class="line">10  OPUS            56  Golden Bow      a7  NeXTSTEP        f0  Linux/PA-RISC b</span><br><span class="line">11  Hidden FAT12    5c  Priam Edisk     a8  Darwin UFS      f1  SpeedStor      </span><br><span class="line">12  Compaq diagnost 61  SpeedStor       a9  NetBSD          f4  SpeedStor      </span><br><span class="line">14  Hidden FAT16 &lt;3 63  GNU HURD or Sys ab  Darwin boot     f2  DOS secondary  </span><br><span class="line">16  Hidden FAT16    64  Novell Netware  af  HFS / HFS+      fb  VMware VMFS    </span><br><span class="line">17  Hidden HPFS/NTF 65  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE </span><br><span class="line">18  AST SmartSleep  70  DiskSecure Mult b8  BSDI swap       fd  Linux raid auto</span><br><span class="line">1b  Hidden W95 FAT3 75  PC/IX           bb  Boot Wizard hid fe  LANstep        </span><br><span class="line">1c  Hidden W95 FAT3 80  Old Minix       be  Solaris boot    ff  BBT            </span><br><span class="line">1e  Hidden W95 FAT1</span><br><span class="line"></span><br><span class="line">Command (m for help): t</span><br><span class="line">Partition number (1-5): 2</span><br><span class="line">Hex code (type L to list codes): 82</span><br><span class="line">Changed system type of partition 2 to 82 (Linux swap / Solaris)</span><br><span class="line"></span><br><span class="line">Command (m for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line"></span><br><span class="line">WARNING: Re-reading the partition table failed with error 16: Device or resource busy.</span><br><span class="line">The kernel still uses the old table. The new table will be used at</span><br><span class="line">the next reboot or after you run partprobe(8) or kpartx(8)</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建交换分区的文件系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# mkswap -L &apos;myswap&apos; /dev/sdb2</span><br><span class="line">Setting up swapspace version 1, size = 5253248 KiB</span><br><span class="line">LABEL=myswap, UUID=fee42b41-d38f-498e-a27f-70a962734a26</span><br></pre></td></tr></table></figure>
</li>
<li><p>激活交换分区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-pc /]# free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:           996        642        354          1        112        304</span><br><span class="line">-/+ buffers/cache:        224        771</span><br><span class="line">Swap:         2015          0       2015</span><br><span class="line">[root@sg-pc /]# swapon -a /dev/sdb2</span><br><span class="line">[root@sg-pc /]# free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:           996        645        350          1        112        304</span><br><span class="line">-/+ buffers/cache:        228        767</span><br><span class="line">Swap:         7146          0       7146</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="分区开机自动挂载"><a href="#分区开机自动挂载" class="headerlink" title="分区开机自动挂载"></a>分区开机自动挂载</h2><p>上述的硬盘的分区都是在系统中临时挂载使用的，当系统重启的话，目前我们挂载的分区并不会自动挂载上去，又需要我们执行挂载的步骤，这样很不方便。如果我们需要硬盘分区在系统重启的时候也能自动挂载，我们需要将分区的配置写到/etc/fstab这个文件中。<br><img src="http://oc4wmeyj8.bkt.clouddn.com/%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD1.png" alt><br> /etc/fstab文件中每一行代表一个启动的时候需要自动挂载的硬盘分区。<br>每一行记录友6个字段组成，按照顺序分别为：</p>
<ul>
<li>要挂载的设备</li>
<li>挂载点</li>
<li>文件系统类型</li>
<li>挂载选项<br>一般为defaults</li>
<li>转储频率<br>指的是备份频率，0表示不做备份，1表示每天做备份，2表示隔天做备份</li>
<li>自检次序<br>0表示不自检<br>1表示首先自检，数值越大自检次序越靠后。</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>我们以上面划分的./dev/sdb1分区为例，将其设置为每次机器重启的时候都会将/dev/sdb1分区挂载到相应的挂载点。<br><img src="http://oc4wmeyj8.bkt.clouddn.com/%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD2.png" alt><br> 在/etc/fstab文件中添加如图所示的一行，表示每次机器重启的时候，都会将/dev/sdb1分区挂载到/backup挂载点上，并且该分区的文件系统类型为ext4类型，挂载选项是defautls，不备份，不自检。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来说，Linux下的硬盘分区以及挂载主要是三个步骤：</p>
<ol>
<li>划分分区</li>
<li>创建文件系统</li>
<li>挂载分区<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
</li>
</ol>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/Xtrabackup备份从库的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/11/Xtrabackup备份从库的问题/" class="post-title-link" itemprop="url">Xtrabackup备份从库的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-11 08:14:05" itemprop="dateCreated datePublished" datetime="2017-07-11T08:14:05+08:00">2017-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h2><ul>
<li>数据库信息<br>主库IP：192.168.1.130<br>从库IP：192.168.1.132<br>主库MySQL版本：5.6.36<br>从库MySQL版本：5.6.35</li>
<li>配置信息<br>主从开启GTID复制<br>主库参数配置:gtid-mode=ON;enforce-gtid-consistency=ON<br>从库参数配置:gtid-mode=ON,enforce-gtid-consistency=ON;log-slave-update=ON;master_info_repository=TABLE;relay_log_info_repository=TABLE</li>
</ul>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><ul>
<li>搭建主从复制，搭建步骤在此省略</li>
<li><p>使用Xtrabackup备份从库数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">备份从库</span><br><span class="line">[root@host-192-168-1-132 backup]# innobackupex --defaults-file=/etc/my.cnf --user=xtrabackup --password=xtrabackup --slave-info --no-timestamp /tmp/backup</span><br><span class="line">应用日志</span><br><span class="line">[root@host-192-168-1-132 backup]# innobackupex --defaults-file=/etc/my.cnf --apply-log /tmp/backup</span><br></pre></td></tr></table></figure>
</li>
<li><p>清空从库数据，并使用备份恢复从库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@host-192-168-1-132 mysqldata1]# innobackupex --defaults-file=/etc/my.cnf --copy-back /tmp/backup/</span><br><span class="line">[root@host-192-168-1-132 mysqldata1]# chown -R mysql:mysql /home/mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看xtrabckup中备份的slave信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@host-192-168-1-132 backup]# cat xtrabackup_slave_info </span><br><span class="line">SET GLOBAL gtid_purged='05dff9fd-5c97-11e7-b3f4-fa163ea44438:1-7';</span><br><span class="line">CHANGE MASTER TO MASTER_AUTO_POSITION=1</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动从库，查看从库信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">[root@host-192-168-1-132 mysqldata1]# service mysqld start</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: 192.168.1.130</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 6306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000002</span><br><span class="line">          Read_Master_Log_Pos: 1615</span><br><span class="line">               Relay_Log_File: mysql-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 649</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000002</span><br><span class="line">             Slave_IO_Running: No</span><br><span class="line">            Slave_SQL_Running: No</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1856</span><br><span class="line">              Relay_Log_Space: 0</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: NULL</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 0</span><br><span class="line">                  Master_UUID: 05dff9fd-5c97-11e7-b3f4-fa163ea44438</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: </span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: 1</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000001 |      151 |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> set global gtid_purged='05dff9fd-5c97-11e7-b3f4-fa163ea44438:1-7';</span><br><span class="line">Query OK, 0 rows affected (0.08 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> start slave;</span><br><span class="line">ERROR 1872 (HY000): Slave failed to initialize relay log info structure from the repository</span><br></pre></td></tr></table></figure>
</li>
<li><p>start slave的时候出现错误，于是重置了slave信息，重新change master 解决问题</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span> reset slave all;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> change master to</span><br><span class="line">    -&gt; master_host='192.168.1.130',</span><br><span class="line">    -&gt; master_user='repl',</span><br><span class="line">    -&gt; master_password='repl',</span><br><span class="line">    -&gt; master_port=6306,</span><br><span class="line">    -&gt; master_auto_position=1;</span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.35 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> start slave;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span> show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.1.130</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 6306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000002</span><br><span class="line">          Read_Master_Log_Pos: 1856</span><br><span class="line">               Relay_Log_File: mysql-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 408</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1856</span><br><span class="line">              Relay_Log_Space: 612</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 3656</span><br><span class="line">                  Master_UUID: 05dff9fd-5c97-11e7-b3f4-fa163ea44438</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: 05dff9fd-5c97-11e7-b3f4-fa163ea44438:1-7</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>XtraBackup备份从库的时候，利用备份恢复数据之后，第一次启动数据库的时候，不会启动I/O线程和SQL线程</li>
<li>Xtrabackup备份从库，虽然保存了原先slave中chang master to的信息，但是不能直接start slave；需要reset slave all之后重新指定主库信息</li>
<li>Xtrabackup备份从库，不会备份GTID_PURGED的信息，需要恢复的时候，自己指定</li>
</ul>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/11/两台备库设置server-id一致的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/11/两台备库设置server-id一致的问题/" class="post-title-link" itemprop="url">两台备库设置server_id一致的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-11 08:13:04" itemprop="dateCreated datePublished" datetime="2017-07-11T08:13:04+08:00">2017-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在《高性能MySQL》上看到说在一主多从的架构中，如果从库的sever_id设置为一样的，可能会导致一些奇怪的现象，例如从库的错误日志中会不断的打印错误日志，会不断的断开连接并重新连接。</p>
<blockquote>
<p>在主库上，会发现两台备库只有一台连接到主库（通常情况下所有的备库都会建立连接等待随时进行复制）。在备库的错误日志中，则会发现反复的重连和连接断开信息，但不会提及被错误配置的服务器ID。</p>
</blockquote>
<p>根据眼见为实，耳听为虚的原则，我搭了一套一主两从的环境，将两台从库的server_id设置为了一样的。但是并没有看到书上提到的现象。考虑了一下，会不会是数据库版本的原因，因为我的测试的数据库版本是5.7.18版本的。于是又重新搭建了一套5.5.36版本的数据库，并成功复现了书上所讲的现象。<br>下面是我的测试步骤。</p>
<h2 id="测试步骤"><a href="#测试步骤" class="headerlink" title="测试步骤"></a>测试步骤</h2><h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><ul>
<li>主库<br>IP：192.168.1.130<br>server_id：3656</li>
<li>从库A<br>IP：192.168.1.36<br>server_id：56</li>
<li>从库B<br>IP：192.168.1.57<br>server_id：56</li>
</ul>
<p>三台主机除server_id之外，其余配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">server_id = 123</span><br><span class="line">[client]</span><br><span class="line">socket = /home/mysql/data/mysqldata5.5/sock/mysql.sock</span><br><span class="line">[mysqld]</span><br><span class="line">#server_id = 3655</span><br><span class="line">server_id = 123</span><br><span class="line">port = 3306</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line">binlog_format = ROW</span><br><span class="line">#binlog_format = STATEMENT</span><br><span class="line">basedir = /home/mysql/program/mysql5.5.36</span><br><span class="line">datadir = /home/mysql/data/mysqldata5.5/mydata</span><br><span class="line">socket = /home/mysql/data/mysqldata5.5/sock/mysql.sock</span><br><span class="line">pid-file = /home/mysql/data/mysqldata5.5/sock/mysql.pid</span><br><span class="line">tmpdir = /home/mysql/data/mysqldata5.5/tmpdir</span><br><span class="line">log-error = /home/mysql/data/mysqldata5.5/log/error.log</span><br><span class="line">slow_query_log</span><br><span class="line">slow_query_log_file = /home/mysql/data/mysqldata5.5/slowlog/slow-query.log</span><br><span class="line">log-bin = /home/mysql/data/mysqldata5.5/binlog/mysql-bin</span><br><span class="line">relay-log = /home/mysql/data/mysqldata5.5/relaylog/mysql-relay-bin</span><br><span class="line">innodb_data_home_dir = /home/mysql/data/mysqldata5.5/innodb_ts</span><br><span class="line">innodb_log_group_home_dir = /home/mysql/data/mysqldata5.5/innodb_log</span><br><span class="line">#innodb_undo_directory = /home/mysql/data/mysqldata5.5/undo/</span><br><span class="line">sync_binlog=1</span><br><span class="line">innodb_file_per_table=1</span><br><span class="line">#skip_grant_tables</span><br><span class="line">expire_logs_days = 1</span><br><span class="line">log_slave_updates = ON</span><br><span class="line">#replicate-same-server-id=1</span><br><span class="line">skip_slave_start</span><br><span class="line">#innodb_undo_tablespaces=1</span><br></pre></td></tr></table></figure></p>
<h3 id="5-5-36版本现象"><a href="#5-5-36版本现象" class="headerlink" title="5.5.36版本现象"></a>5.5.36版本现象</h3><p>初始搭建环境之后，查看各主机状态。搭建环境的步骤就省略。</p>
<h4 id="主库（192-168-1-130）"><a href="#主库（192-168-1-130）" class="headerlink" title="主库（192.168.1.130）"></a>主库（192.168.1.130）</h4><p>主库通过show processlist语句查看，只有一个dump线程，但是通过多次刷新，可以看到连接的是不同的服务器。可以看到每次通过show processlist语句显示的dump线程的Host字段中，IP:PORT的值是不断在更新的，说明dump线程在不断的重连，才会出现占用不同的端口的现象。</p>
<h4 id="从库A（192-168-1-36）"><a href="#从库A（192-168-1-36）" class="headerlink" title="从库A（192.168.1.36）"></a>从库A（192.168.1.36）</h4><p>通过<code>show slave status\G</code>命令查看复制状态，多次执行可以看到<code>Slave_IO_Running</code>字段显示的内容，出现YES或者Connnecting两种状态。可以看到I/O线程在不断的进行重连。<br>并且通过<code>tail -f</code>命令查看error log，可以看到I/O线程一直在尝试重新连接。</p>
<p> 可以看到在错误日志中打印的信息是，I/O线程连接</p>
<h4 id="从库B（192-168-1-57）"><a href="#从库B（192-168-1-57）" class="headerlink" title="从库B（192.168.1.57）"></a>从库B（192.168.1.57）</h4><p>从库B现象与从库A一致。</p>
<h3 id="5-6-36版本现象"><a href="#5-6-36版本现象" class="headerlink" title="5.6.36版本现象"></a>5.6.36版本现象</h3><p>搭建环境步骤省略。</p>
<h4 id="主库（192-168-1-130）-1"><a href="#主库（192-168-1-130）-1" class="headerlink" title="主库（192.168.1.130）"></a>主库（192.168.1.130）</h4><p>show processlist查看有两个dump线程，并且多次刷新，发现Host字段中的IP:PORT并没有修改，说明dump线程一直保持连接。</p>
<h4 id="从库A（192-168-1-36）-1"><a href="#从库A（192-168-1-36）-1" class="headerlink" title="从库A（192.168.1.36）"></a>从库A（192.168.1.36）</h4><p>tail -f /home/mysql/data/mysqldata5.6/log/error.log查看错误日志，没有不断断开连接</p>
<h4 id="从库B（192-168-1-57）-1"><a href="#从库B（192-168-1-57）-1" class="headerlink" title="从库B（192.168.1.57）"></a>从库B（192.168.1.57）</h4><p>tail -f /home/mysql/data/mysqldata5.6/log/error.log查看错误日志，没有不断断开连接</p>
<h2 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h2><p><a href="http://www.penglixun.com/tech/database/mysql_multi_slave_same_serverid.html" target="_blank" rel="noopener">http://www.penglixun.com/tech/database/mysql_multi_slave_same_serverid.html</a>这是彭大大写的关于多个slave使用相同server_id时冲突的原因。按照彭大大的分析，我理解的是，slave的I/O线程连接上主库的时候，主库上会调用<code>register_slave()</code>这个函数，在这个函数中又调用了unregister_slave()函数，会将之前使用相同server_id的线程给注销掉。从而导致从库的I/O线程不断断开重连。<br>但是仔细看了一下unregister_slave()函数的代码，并没有发现MySQL是根据server_id来注销dump线程的。并且进一步比较了一下5.5.36和5.6.36版本的代码，并没有发现不同。<br>进一步看了一下彭大大的文章，发现有人在下面评论，说主要是<code>kill_zombie_slave_threads()</code>函数导致的。于是看了一下<code>kill_zombie_slave_threads()</code>函数的逻辑，发现MySQL应该就是在这一步根据server_id将线程kill了。</p>
<ul>
<li><p>5.5.36版本<br>首先来看下5.5.36版本的<code>kill_zombie_dump_threads()</code>函数的代码。看到这个函数传入的参数是一个uint32类型的slave_server_id,在函数中做的事情是，遍历MySQL中的所有线程，如果遍历到一个线程是dump线程并且线程的server_id是等于传入的参数值话，则跳出遍历循环，并对kill掉这个线程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">void kill_zombie_dump_threads(uint32 slave_server_id)                           </span><br><span class="line">&#123;                                                                               </span><br><span class="line">  mysql_mutex_lock(&amp;LOCK_thread_count);                                         </span><br><span class="line">  I_List_iterator&lt;THD&gt; it(threads);                                             </span><br><span class="line">  THD *tmp;                                                                     </span><br><span class="line">  while ((tmp=it++))                                                            </span><br><span class="line">  &#123;                                                                             </span><br><span class="line">    if (tmp-&gt;command == COM_BINLOG_DUMP &amp;&amp;                                      </span><br><span class="line">      tmp-&gt;server_id == slave_server_id)                                       </span><br><span class="line">    &#123;                                                                           </span><br><span class="line">     mysql_mutex_lock(&amp;tmp-&gt;LOCK_thd_data);    // Lock from delete             </span><br><span class="line">     break;                                                                    </span><br><span class="line">    &#125;                                                                           </span><br><span class="line">  &#125;                                                                             </span><br><span class="line">  mysql_mutex_unlock(&amp;LOCK_thread_count);                                       </span><br><span class="line">  if (tmp)                                                                      </span><br><span class="line">  &#123;                                                                             </span><br><span class="line">    /*                                                                          </span><br><span class="line">     Here we do not call kill_one_thread() as                                  </span><br><span class="line">     it will be slow because it will iterate through the list                  </span><br><span class="line">     again. We just to do kill the thread ourselves.                           </span><br><span class="line">    */                                                                          </span><br><span class="line">    tmp-&gt;awake(THD::KILL_QUERY);                                                </span><br><span class="line">    mysql_mutex_unlock(&amp;tmp-&gt;LOCK_thd_data);                                    </span><br><span class="line">  &#125;                                                                             </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>5.6.35版本<br>再来看一下5.6.36版本的<code>kill_zombie_dump_threads()</code>函数的代码实现，与5.5.36大不相同。首先传入的参数是一THD类型的指针，在函数中实现的逻辑同样是遍历MySQL中的所有线程，如果找到dump线程，首先看一下这个线程有没有uuid字段（因为uuid是在5.6之后的版本才有的，这边是为了兼容5.5），如果有uuid则用uuid进行比较，如果没有uuid，则用server_id进行比较。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"> void kill_zombie_dump_threads(THD *thd)                                                                                                  </span><br><span class="line">&#123;                                                                               </span><br><span class="line">  String slave_uuid;                                                            </span><br><span class="line">  get_slave_uuid(thd, &amp;slave_uuid);                                             </span><br><span class="line">  if (slave_uuid.length() == 0 &amp;&amp; thd-&gt;server_id == 0)                          </span><br><span class="line">    return;                                                                     </span><br><span class="line">                                                                                </span><br><span class="line">  mysql_mutex_lock(&amp;LOCK_thread_count);                                         </span><br><span class="line">  THD *tmp= NULL;                                                               </span><br><span class="line">  Thread_iterator it= global_thread_list_begin();                               </span><br><span class="line">  Thread_iterator end= global_thread_list_end();                                </span><br><span class="line">  bool is_zombie_thread= false;                                                 </span><br><span class="line">  for (; it != end; ++it)                                                       </span><br><span class="line">  &#123;                                                                             </span><br><span class="line">    if ((*it) != thd &amp;&amp; ((*it)-&gt;get_command() == COM_BINLOG_DUMP || (*it)-&gt;get_command() == COM_BINLOG_DUMP_GTID))         </span><br><span class="line">    &#123;                                                                           </span><br><span class="line">     String tmp_uuid;                                                          </span><br><span class="line">     get_slave_uuid((*it), &amp;tmp_uuid);                                         </span><br><span class="line">     if (slave_uuid.length())                                                  </span><br><span class="line">     &#123;                                                                         </span><br><span class="line">       is_zombie_thread= (tmp_uuid.length() &amp;&amp; !strncmp(slave_uuid.c_ptr(),                         </span><br><span class="line">                                         tmp_uuid.c_ptr(), UUID_LENGTH)); </span><br><span class="line">                                                                       </span><br><span class="line">     else                                                                      </span><br><span class="line">     &#123;                                                                         </span><br><span class="line">       /*                                                                      </span><br><span class="line">       ¦ Check if it is a 5.5 slave&apos;s dump thread i.e., server_id should be    </span><br><span class="line">       ¦ same &amp;&amp; dump thread should not contain &apos;UUID&apos;.                        </span><br><span class="line">       */                                                                      </span><br><span class="line">       is_zombie_thread= (((*it)-&gt;server_id == thd-&gt;server_id) &amp;&amp; !tmp_uuid.length());                                 </span><br><span class="line">     &#125;                                                                         </span><br><span class="line">     if (is_zombie_thread)                                                     </span><br><span class="line">     &#123;                                                                         </span><br><span class="line">       tmp= *it;                                                               </span><br><span class="line">       mysql_mutex_lock(&amp;tmp-&gt;LOCK_thd_data);  // Lock from delete             </span><br><span class="line">       break;                                                                  </span><br><span class="line">     &#125;                                                                         </span><br><span class="line">    &#125;                                                                           </span><br><span class="line">  &#125;                                                                             </span><br><span class="line">  mysql_mutex_unlock(&amp;LOCK_thread_count);                                       </span><br><span class="line">  if (tmp)                                                                      </span><br><span class="line">  &#123;                                                                             </span><br><span class="line">    /*                                                                          </span><br><span class="line">    ¦ Here we do not call kill_one_thread() as                                  </span><br><span class="line">    ¦ it will be slow because it will iterate through the list                  </span><br><span class="line">    ¦ again. We just to do kill the thread ourselves.                           </span><br><span class="line">    */                                                                          </span><br><span class="line">    if (log_warnings &gt; 1)                                                       </span><br><span class="line">    &#123;                                                                           </span><br><span class="line">     if (slave_uuid.length())                                                  </span><br><span class="line">     &#123;                                                                       </span><br><span class="line"> sql_print_information(&quot;While initializing dump thread for slave with &quot;  </span><br><span class="line">&quot;UUID &lt;%s&gt;, found a zombie dump thread with the &quot; </span><br><span class="line"> &quot;same UUID. Master is killing the zombie dump &quot;   </span><br><span class="line"> &quot;thread(%lu).&quot;, slave_uuid.c_ptr(),               </span><br><span class="line"> tmp-&gt;thread_id);                                  </span><br><span class="line">     &#125;                                                                         </span><br><span class="line">     else                                                                      </span><br><span class="line">     &#123;                                                                         </span><br><span class="line">       sql_print_information(&quot;While initializing dump thread for slave with &quot;  </span><br><span class="line"> &quot;server_id &lt;%u&gt;, found a zombie dump thread with the &quot;</span><br><span class="line">&quot;same server_id. Master is killing the zombie dump &quot;</span><br><span class="line"> &quot;thread(%lu).&quot;, thd-&gt;server_id,                   </span><br><span class="line"> tmp-&gt;thread_id);                                  </span><br><span class="line">     &#125;                                                                         </span><br><span class="line">    &#125;                                                                           </span><br><span class="line">    tmp-&gt;duplicate_slave_id= true;                                              </span><br><span class="line">    tmp-&gt;awake(THD::KILL_QUERY);                                                </span><br><span class="line">    mysql_mutex_unlock(&amp;tmp-&gt;LOCK_thd_data);                                    </span><br><span class="line">  &#125;                                                                             </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>函数调用<br>知道了<code>kill_zombie_dump_threads()</code>线程实现的逻辑，那MySQL是在什么地方会调用这个函数的呢。看了一下函数是在<code>case COM_BINLOG_DUMP</code>中被调用的。<br>在5.5.36版本中是在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">case COM_BINLOG_DUMP:                                                         </span><br><span class="line"> &#123;                                                                           </span><br><span class="line"> ulong pos;                                                                </span><br><span class="line"> ushort flags;                                                             </span><br><span class="line"> uint32 slave_server_id;                                                                                                                                 </span><br><span class="line"> status_var_increment(thd-&gt;status_var.com_other);                          </span><br><span class="line"> thd-&gt;enable_slow_log= opt_log_slow_admin_statements;                      </span><br><span class="line"> if (check_global_access(thd, REPL_SLAVE_ACL))                             </span><br><span class="line">break;                                                                                                                                                 </span><br><span class="line"> /* TODO: The following has to be changed to an 8 byte integer */          </span><br><span class="line"> pos = uint4korr(packet);                                                  </span><br><span class="line"> flags = uint2korr(packet + 4);                                            </span><br><span class="line"> thd-&gt;server_id=0; /* avoid suicide */                                     </span><br><span class="line"> if ((slave_server_id= uint4korr(packet+6))) // mysqlbinlog.server_id==0   </span><br><span class="line"> kill_zombie_dump_threads(slave_server_id);                                  </span><br><span class="line"> thd-&gt;server_id = slave_server_id;                                                                                                                    </span><br><span class="line"> general_log_print(thd, command, &quot;Log: &apos;%s&apos;  Pos: %ld&quot;, packet+10,  (long) pos);                                              </span><br><span class="line"> mysql_binlog_send(thd, thd-&gt;strdup(packet + 10), (my_off_t) pos, flags);  </span><br><span class="line">unregister_slave(thd,1,1);                                                </span><br><span class="line">/*  fake COM_QUIT -- if we get here, the thread needs to terminate */     </span><br><span class="line"> error = TRUE;                                                             </span><br><span class="line">break;                                                                    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在5.6.36版本中也是在<code>case COM_BINLOG_DUMP</code>中，只不过是将之前的逻辑封装在了<code>com_binlog_dump()</code>函数中了，<code>kill_zombie_dump_threads()</code>也是在<code>com_binlog_dump()</code>函数中调用的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">case COM_BINLOG_DUMP:                                                         </span><br><span class="line">error= com_binlog_dump(thd, packet, packet_length);                                                                                  </span><br><span class="line">break;</span><br></pre></td></tr></table></figure></p>
<p><code>case COM_BINLOG_DUMP</code>中所进行的操作就是将dump线程通知I/O线程拉取新的binlog。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>整理下来的话，基本上可以确定主要是因为<code>kill_zombie_dump_threads()</code>函数导致在5.6之前的版本中，如果是一主多从的架构中，如果在从库之间的server_id如果设置为一样，会出现从开I/O线程不断断开重连的现象。因为在5.6之前的版本中，还没有UUID的概念，MySQL使用server_id来区分是否是同一台机器，而在5.6之后的版本是使用的UUID来区分。<br>总结一句，就是数据库之间的server_id不要设置成一样，不然可能会有一些不可预知的错误。</p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/14/2016总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/14/2016总结/" class="post-title-link" itemprop="url">2016总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-01-14 10:09:21" itemprop="dateCreated datePublished" datetime="2017-01-14T10:09:21+08:00">2017-01-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂/" itemprop="url" rel="index"><span itemprop="name">杂</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>　　其实这篇年终总结早就想写了，可是拖延症犯了，一直拖啊拖啊，已经拖过了 2016 与 2017 年的交界，可是作为一名中国人，我为什么一定要以公历年份来划分我的时间呢，我选择猴年与鸡年来划分我的时间。所以，这篇总结不算晚。</p>
<h2 id="1-回顾"><a href="#1-回顾" class="headerlink" title="1.回顾"></a>1.回顾</h2><h3 id="1-1-实习"><a href="#1-1-实习" class="headerlink" title="1.1 实习"></a>1.1 实习</h3><p>　　过去的一年，由我大三下与大四上组成。从一开始就没有考研的打算，实习便成为了我的一年的主要内容。</p>
<p>　　第一段实习经历是在实验室老师成立的公司，做了一段时间的 Java 开发，之后选择了换一家公司。原因总结来说的话，就是看不到未来，那时候还有一点<strong>技术改变世界</strong>的想法，感觉做出来的产品完全称不上是一个产品，简直就是学校里一个课程设计。老板出去还把这产品吹的天花乱坠的，实际上完全是另一回事。所以果断弃坑。</p>
<p>　　第二段实习经历，主要是为了完成学院的实习要求，还是做 Java 开发。中间过程没有一点可言的。不过也要感谢这段实习经历，让我有时间静下来，学一些东西。也就是在这个期间，我将我的博客从 CSDN 转到了 GitHub，加入了 itsCoder ······ 让我有时间去做我想做的事情了。最后完成学院要求之后，还是毅然决然的离开了，因为不明白，为什么一个成立时间不到两年的一个公司，整天的气氛是死气沉沉的，没有技术氛围。</p>
<p>　　第三段实习经历，就是目前正在经历着的。结束上一段实习经历的时候，我就打算这次好好找一个实习，奔着毕业之后转正的目的找的。投了一波简历，面了一波试。在最后选择了现在的公司，并且完成了转型，从开发转行成为了一名 DBA 。到目前为止，我想我应该是找到了我想要的工作。</p>
<h3 id="1-2-学习"><a href="#1-2-学习" class="headerlink" title="1.2 学习"></a>1.2 学习</h3><p>　　学习这方面的话，整体上进度是不大的。花了前面大半年的时间，都是在学习开发方面的内容，学框架，学技术，学算法，最后怎么也没想到直接从开发转行了，所以学的很多东西对于工作来说，意义不大了。转行 DBA，开始接触数据库开始，才发现原来数据库水这么深，之前理解的数据库就是一个数据的增删改查，之后发现这就是一个新的世界。</p>
<h3 id="1-3-其余"><a href="#1-3-其余" class="headerlink" title="1.3 其余"></a>1.3 其余</h3><p>　　过去的一年，算是崩坏的一年。</p>
<p>　　身体没有好好锻炼，锻炼一段时间歇一段时间的；</p>
<p>　　书没好好读，好多书都是走马观花的浏览了一遍，也没看到心里去；</p>
<p>　　习惯没有好好养成，有很多习惯想要养成，现在看来一个也没成功；</p>
<p>　　计划没有好好执行，计划任然是计划。</p>
<p>　　一年时间，体重飙涨20斤，还好及时发现，狠命锻炼一段时间，减到 70KG ，目前仍维持着。</p>
<p>　　自控力下降，执行力降低。</p>
<p>　　上一张 Github 2016 年的记录，最难做到的还是坚持：</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/github-2016.PNG" alt></p>
<h2 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h2><p>　　一句话总结我过去的猴年：<strong>瞎搞</strong>。<br>　　本来一开始想去大公司开始实习的，准备准备，干一波春招。结果被老师打乱了节奏，三段实习经历，公司都不大，但也发现了小公司的好处。自由。不打卡，可以有自己的话语权，公司同事整体年龄比较年轻，有活力。</p>
<p>　　一年下来，没有多少收获，只是找到了之后的职业方向，对自己职业也有了初步的规划。我觉得有这一点也已经够了。</p>
<h2 id="3-计划"><a href="#3-计划" class="headerlink" title="3.计划"></a>3.计划</h2><p>　　又到了制定计划的时候了，把话撂在这，等着明年来打脸（注定的：</p>
<ol>
<li>顺利毕业</li>
<li>读 35 本书，至少完成 20 本书的读书笔记或感想</li>
<li>12 篇认真完成的博客</li>
<li>保证规律的作息时间，不熬夜，11点准时睡觉</li>
<li>锻炼，保证每周至少三次的锻炼</li>
<li>出去走走，一个人也好，两个人也好 </li>
</ol>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/31/Linux基础之Tmux使用姿势/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/31/Linux基础之Tmux使用姿势/" class="post-title-link" itemprop="url">Linux基础之Tmux使用姿势</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-31 14:15:00" itemprop="dateCreated datePublished" datetime="2016-12-31T14:15:00+08:00">2016-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><p>　　之前讲了如何安装 Tmux，这篇文章讲讲如何使用 Tmux。其实工具的使用都是很简单，最终是看你如何使用这个工具，才能发挥出工具最大的作用。</p>
<h2 id="2-基础知识"><a href="#2-基础知识" class="headerlink" title="2. 基础知识"></a>2. 基础知识</h2><p>　　在讲如何使用 Tmux 之前，我们需要先熟悉它的几个概念。</p>
<ul>
<li>会话（Session）</li>
<li>窗口（Window）</li>
<li>面板（Pane）</li>
</ul>
<p><strong>会话：</strong>会话的概念很好理解。我们一台服务器正在那边运行着，我们拿终端工具如：XShell、SecureCRT 等去连接的时候，每新建一个连接，就是一个新的会话。使用 Tmux 新建会话的时候，也是一样，一个新的会话就表示一个新的连接。</p>
<p><strong>窗口：</strong>窗口的概念，可以类比于 Windows 里面的窗口的概念。之前我们连服务器的时候，终端工具每次连接只有一个界面，当我们需要同时操作多个过程的时候，我们就需要建立新的连接。这样很不方便。Tmux 里面的窗口的概念，就可以让我们在一个会话里有多个界面，就不需要去建立的一个会话。</p>
<p><strong>面板：</strong>面板的概念的话，是用于对界面的布局而言的。就是将一个界面划分为多个不同的区域，每个区域我们称之为一个面板。</p>
<p>　　简单来说就是，一个会话里面可以有多个窗口，一个窗口里面可以有多个面板。</p>
<h2 id="3-命令行使用方式"><a href="#3-命令行使用方式" class="headerlink" title="3. 命令行使用方式"></a>3. 命令行使用方式</h2><p>　　Tmux 可以有两种使用方式，一种是命令行的方式，一种是快捷键的方式。前者的话不需要怎么记忆，后者的话效率更高。我觉得还是命令行入门，先熟悉这个工具的作用，之后将常用的几个功能的快捷键记下来，多使用，多熟练。</p>
<h3 id="3-1-会话操作"><a href="#3-1-会话操作" class="headerlink" title="3.1 会话操作"></a>3.1 会话操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="keyword">new</span> -s [session_name]  <span class="comment">//  创建一个会话</span></span><br></pre></td></tr></table></figure>
<p>创建完会话之后，会自动进入这个会话之内。并且会话默认帮你创建好一个窗口。<br><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-1.png" alt></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="built_in">list</span>-sessions <span class="comment">// 显示所有会话，也可以简写成 tmux ls</span></span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-2.png" alt></p>
<p> 当前的话，我一共有一个会话，并且会话的名称为： session1 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tmux detach <span class="comment">// 退出当前的会话，返回 shell 界面</span></span><br><span class="line">$ tmux kill-session -t [session_name ] <span class="comment">// 结束一个会话</span></span><br><span class="line">$ tmux attach -t [session_name] <span class="comment">// 回到某一个会话当中</span></span><br><span class="line">$ tmux <span class="keyword">switch</span> -t [session_name] <span class="comment">// 切换到某一会话当中</span></span><br><span class="line">$ tmux kill-server <span class="comment">// 关闭所有会话</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-窗口操作"><a href="#3-2-窗口操作" class="headerlink" title="3.2 窗口操作"></a>3.2 窗口操作</h3><p>　　讲完会话的操作，我们来讲讲窗口的操作。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="keyword">new</span>-window [-n window_name] <span class="comment">// 创建一个新的窗口，可以指定新的窗口的名字也可以不指定</span></span><br></pre></td></tr></table></figure></p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-3.png" alt></p>
<p> 这边，我新建了一个名为 window1 的窗口，并且 Tmux 自动帮我切换到了这个窗口，<code>*</code> 标记当前正在使用的窗口，一个窗口默认包含一个面板。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux rename-window [new_window_name] <span class="comment">// 重命名当前窗口的名字</span></span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-4.png" alt></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="built_in">list</span>-windows <span class="comment">// 显示当前会话中所有的窗口</span></span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-5.png" alt></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tmux kill-window -t [window_name | window_index] <span class="comment">// 关闭一个窗口</span></span><br><span class="line">$ tmux select-window -t [window_index] <span class="comment">// 切换窗口</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-面板操作"><a href="#3-3-面板操作" class="headerlink" title="3.3 面板操作"></a>3.3 面板操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tmux split-window <span class="comment">//将一个面板垂直切成两个面板</span></span><br><span class="line">$ tmux split-window -h <span class="comment">// 将一个面板水平切成两个面板</span></span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux-6.png" alt></p>
<p> 可以看到图片中的话，我将一个窗口切成了三部分区域，每一个区域都是一个面板。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tmux swap-pane -[UDRL] <span class="comment">// 选择 [ 上下左右 ] 的面板交换</span></span><br><span class="line">$ tmux select-pane -[UDRL] <span class="comment">// 选择 [ 上下左右 ] 的面板进行切换</span></span><br></pre></td></tr></table></figure>
<p>　　以上的话就是同过命令行的方式使用 Tmux，使用命令行的方式，可以简单了解一下 Tmux 这个工具提供的一些功能。接下来就是进阶的，使用快捷键的方式操作 Tmux。</p>
<h2 id="4-快捷键使用方式"><a href="#4-快捷键使用方式" class="headerlink" title="4. 快捷键使用方式"></a>4. 快捷键使用方式</h2><p>　　Tmux 快捷键的话需要先按下前缀键，之后再按快捷键才会有效果。 Tmux 默认的前缀键是 <code>Ctrl + b</code>。我就只简单罗列一下快捷键，实际效果的话，使用一下就知道了，上面使用命令行能达到的功能，都能找到相应的快捷键。</p>
<p>　　Tmux 还有一个配置文件，可以根据自己的习惯将快捷键改成自己喜欢的键。</p>
<h3 id="4-1-基本操作"><a href="#4-1-基本操作" class="headerlink" title="4.1 基本操作"></a>4.1 基本操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">? 列出所有快捷键；按q返回</span><br><span class="line">d 脱离当前会话,可暂时返回Shell界面</span><br><span class="line">s 选择并切换会话；在同时开启了多个会话时使用</span><br><span class="line">D 选择要脱离的会话；在同时开启了多个会话时使用</span><br><span class="line">: 进入命令行模式；此时可输入支持的命令，例如 kill-server 关闭所有tmux会话</span><br><span class="line">[ 复制模式，光标移动到复制内容位置，空格键开始，方向键选择复制，回车确认，q/Esc退出</span><br><span class="line">] 进入粘贴模式，粘贴之前复制的内容，按q/Esc退出</span><br><span class="line">~ 列出提示信息缓存；其中包含了之前tmux返回的各种提示信息</span><br><span class="line">t 显示当前的时间</span><br><span class="line">ctrl + z 挂起当前会话</span><br></pre></td></tr></table></figure>
<h3 id="4-2-窗口操作"><a href="#4-2-窗口操作" class="headerlink" title="4.2 窗口操作"></a>4.2 窗口操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c 创建新窗口</span><br><span class="line">&amp; 关闭当前窗口</span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>] 数字键切换到指定窗口</span><br><span class="line">p 切换至上一窗口</span><br><span class="line">n 切换至下一窗口</span><br><span class="line">l 前后窗口间互相切换</span><br><span class="line">w 通过窗口列表切换窗口</span><br><span class="line">, 重命名当前窗口，便于识别</span><br><span class="line">. 修改当前窗口编号，相当于重新排序</span><br><span class="line">f 在所有窗口中查找关键词，便于窗口多了切换</span><br></pre></td></tr></table></figure>
<h3 id="4-3-面板操作"><a href="#4-3-面板操作" class="headerlink" title="4.3 面板操作"></a>4.3 面板操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">" 将当前面板上下分屏</span></span><br><span class="line"><span class="string">% 将当前面板左右分屏</span></span><br><span class="line"><span class="string">x 关闭当前分屏</span></span><br><span class="line"><span class="string">! 将当前面板置于新窗口,即新建一个窗口,其中仅包含当前面板</span></span><br><span class="line"><span class="string">ctrl+方向键 以1个单元格为单位移动边缘以调整当前面板大小</span></span><br><span class="line"><span class="string">alt+方向键 以5个单元格为单位移动边缘以调整当前面板大小</span></span><br><span class="line"><span class="string">q 显示面板编号</span></span><br><span class="line"><span class="string">o 选择当前窗口中下一个面板</span></span><br><span class="line"><span class="string">方向键 移动光标选择对应面板</span></span><br><span class="line"><span class="string">&#123; 向前置换当前面板</span></span><br><span class="line"><span class="string">&#125; 向后置换当前面板</span></span><br><span class="line"><span class="string">alt+o 逆时针旋转当前窗口的面板</span></span><br><span class="line"><span class="string">ctrl+o 顺时针旋转当前窗口的面板</span></span><br><span class="line"><span class="string">z 最大化当前所在面板</span></span><br><span class="line"><span class="string">page up 向上滚动屏幕，q 退出</span></span><br><span class="line"><span class="string">page down 向下滚动屏幕，q 退出</span></span><br></pre></td></tr></table></figure>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2><p>　　说到底 Tmux 也就是这么一个工具，功能也就这么多，但是将 Tmux 和 Vim 结合起来的时候，效果就不一样了，在命令行下开发，整个逼格一下就上去了。装逼使人进步。</p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/28/Linux基础之Tmux安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/28/Linux基础之Tmux安装/" class="post-title-link" itemprop="url">Linux基础之Tmux安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-28 20:02:11" itemprop="dateCreated datePublished" datetime="2016-12-28T20:02:11+08:00">2016-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>　　Linux 命令行装逼利器——Tmux。转行 DBA 之后整天和命令行打交道，在装逼的道路上越走越远了。Tmux 是 Linux 命令行下一个工具，让我可以更加方便的<strong>装逼</strong>。先讲一下怎么安装这个工具，之后再写一篇文章记录一下怎么使用这个工具。</p>
<p><strong>系统环境：</strong></p>
<blockquote>
<p>CentOS 6.5</p>
</blockquote>
<h2 id="2-安装过程"><a href="#2-安装过程" class="headerlink" title="2.安装过程"></a>2.安装过程</h2><p>　　<code>tmux</code> 工具依赖于 <code>libevent</code> 和 <code>ncurses</code> 两个软件包。我们先安装这两个软件包。</p>
<h3 id="2-1-libevent-安装"><a href="#2-1-libevent-安装" class="headerlink" title="2.1 libevent 安装"></a>2.1 libevent 安装</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下载 tar.gz 文件  </span></span><br><span class="line"><span class="comment">// 可以在 http://libevent.org/ 网站上找到最新版本</span></span><br><span class="line">$ wget https:<span class="comment">//cloud.github.com/downloads/libevent/libevent/libevent-2.0.21-stable.tar.gz</span></span><br><span class="line"><span class="comment">// 解压 tar.gz 文件</span></span><br><span class="line">$ tar zxvf libevent<span class="number">-2.0</span><span class="number">.21</span>-stable.tar.gz</span><br><span class="line">$ cd libevent<span class="number">-2.0</span><span class="number">.21</span>-stable</span><br><span class="line"><span class="comment">// 配置安装路径并编译安装，这边可能会出现127错误，可以在./configure中加上--without-cxx-binding参数</span></span><br><span class="line">$ ./configure --prefix=/usr/local/libevent</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<h3 id="2-2-ncurses-安装"><a href="#2-2-ncurses-安装" class="headerlink" title="2.2 ncurses 安装"></a>2.2 ncurses 安装</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install ncurses-devel</span><br></pre></td></tr></table></figure>
<h3 id="2-3-tmux-安装"><a href="#2-3-tmux-安装" class="headerlink" title="2.3 tmux 安装"></a>2.3 tmux 安装</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下载 tar.gz 文件 在 https://tmux.github.io/ 可以下载到最新版</span></span><br><span class="line">$ wget https:<span class="comment">//github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz</span></span><br><span class="line"><span class="comment">// 解压 tar.gz 文件</span></span><br><span class="line">$ tar zxvf tmux<span class="number">-2.3</span>.tar.gz </span><br><span class="line">$ cd tmux<span class="number">-2.3</span></span><br><span class="line"><span class="comment">// 配置安装参数并编译安装</span></span><br><span class="line">$ CFLAGS=<span class="string">"-I/usr/local/libevent/include -I/usr/local/ncurses/include"</span> LDFLAGS=<span class="string">"-L/usr/local/libevent/lib -L/usr/local/ncurses/lib"</span> ./configure --prefix=/usr/local/tmux</span><br><span class="line">$ make</span><br><span class="line">$ make install</span><br></pre></td></tr></table></figure>
<h3 id="2-4-配置-PATH-环境变量"><a href="#2-4-配置-PATH-环境变量" class="headerlink" title="2.4 配置 PATH 环境变量"></a>2.4 配置 PATH 环境变量</h3><p>在 /etc/profile 最末尾增加 <code>PATH=$PATH:/usr/local/tmux/bin</code>，并使用 <code>source</code> 命令生效。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 tmux 拷贝到环境变量目录下</span></span><br><span class="line">$ cp /usr/local/tmux/bin/tmux /usr/local/bin/</span><br></pre></td></tr></table></figure>
<h2 id="3-错误及解决方案"><a href="#3-错误及解决方案" class="headerlink" title="3.错误及解决方案"></a>3.错误及解决方案</h2><h3 id="3-1-问题一"><a href="#3-1-问题一" class="headerlink" title="3.1 问题一"></a>3.1 问题一</h3><p>　　运行 <code>tmux</code> 命令提示 <code>libevent-2.0.so.5</code> 找不到。</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/tmux%E5%AE%89%E8%A3%85%E9%97%AE%E9%A2%981.png" alt></p>
<p>　　<strong>解决方案</strong>：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 libevent-2.0.so.5 移动到 /usr/lib64 下（64位操作系统） | /usr/lib 下（32位操作系统）</span></span><br><span class="line">$ cp /usr/local/libevent/lib/libevent<span class="number">-2.0</span>.so<span class="number">.5</span> /usr/lib64</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/win_man_20161224_mysql_binary_log_group_commit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/07/win_man_20161224_mysql_binary_log_group_commit/" class="post-title-link" itemprop="url">MySQL基础之BLGC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-07 10:09:21" itemprop="dateCreated datePublished" datetime="2016-12-07T10:09:21+08:00">2016-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-组提交介绍"><a href="#1-组提交介绍" class="headerlink" title="1. 组提交介绍"></a>1. 组提交介绍</h1><h2 id="1-1-什么是组提交"><a href="#1-1-什么是组提交" class="headerlink" title="1.1 什么是组提交"></a>1.1 什么是组提交</h2><p>　　Binary Log Group Commit 即二进制日志组提交。这是 MySQL5.6 版本中引进的一个新的特性。为什么需要引进这个特性呢？我们知道当我们把 MySQL 的 binlog 开启的时候，MySQL 会将每个事务的操作都记录到 binlog 中，方便我们使用 binlog 来完成复制或者恢复操作。可是需要调用 <code>fsync()</code> 才能将缓存中被更改的 binlog 真正的写到磁盘上，保证数据的持久化。但是这是一个从内存写到磁盘的过程，I/O 比较慢。如果每次事务提交都执行一遍 <code>fsync()</code> 将 binlog 持久化落盘到磁盘的话，效率很低。于是就想，能不能等几个事务的 binlog 一起调用一次 <code>fsync()</code>，一次性落盘。减少 <code>fsync()</code> 的次数，从而提高效率。这就是二进制日志组提交的概念。</p>
<h1 id="2-两阶段提交"><a href="#2-两阶段提交" class="headerlink" title="2.两阶段提交"></a>2.两阶段提交</h1><h2 id="2-1-为什么需要二阶段提交"><a href="#2-1-为什么需要二阶段提交" class="headerlink" title="2.1 为什么需要二阶段提交"></a>2.1 为什么需要二阶段提交</h2><p>　　我们知道在 MySQL 中不仅仅有 binlog，还有 redo log 和 undo log 。binlog 用来记录每个事务的操作信息，redo 是在数据库宕机恢复时使用，用来恢复数据库数据，undo 用来回滚还未被提交的数据。binlog 是在数据库 Server 层产生的，即它会记录所有存储引擎中事务的操作，而 redo 是 InnoDB 存储引擎特有的日志。</p>
<p>　　在事务提交的时候，我们需要先写入二进制日志，再写 InnoDB 存储引擎的 redo。并且要求二进制日志和 redo 要么都写，要么都不写。不然可能会出现这样的情况：在主从复制的环境下，master 提交了一个事务，先写了二进制日志，但是在要写 InnoDB 存储引擎的时候，数据库发生了宕机，此时 binlog 又已经被 slave 接收到了，slave 会执行这个事务，但是实际 master 上并没有这个事务。这就会导致主从数据的不一致。所以我们引入了二阶段提交来解决这个问题，即将写 binlog 操作个 InnoDB 提交操作通过事务变成原子的。</p>
<h2 id="2-2-什么是二阶段提交"><a href="#2-2-什么是二阶段提交" class="headerlink" title="2.2 什么是二阶段提交"></a>2.2 什么是二阶段提交</h2><p>　　所谓的二阶段提交就是，我在事务提交的时候，确保先将 binlog 写入，然后再到数据引擎层提交，并且这两个操作是原子的。在 MySQL 中用内部的 XA 事务来完成，即将这两个操作包装成一个事务的概念。</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4.png" alt></p>
<p>　　上图表示了二阶段提交的过程。当一个会话中的某一事务 COMMIT 的时候，进去二阶段提交的过程。首先数据库先去协调 Server 层和 Engine，询问是否都可以开始写日志，这个过程就是图中的的 prepare 阶段。协调好两层之间的关系，Server 层和 Engine 层都表示可以写日志，这时候进入下一个过程。</p>
<p>　　第二个过程就是写 binlog 的过程，先把 binlog 写到内存中，然后调用 <code>fsync()</code> 将 binlog 从内存写到磁盘上。</p>
<p>　　第三个过程就是在存储引擎层提交的过程，将真实修改的数据提交到数据库中。当这一步完成才最终返回给会话一个 COMMIT 成功的信号。</p>
<p>　　这整个过程就是二阶段提交的过程，如果在 <code>fsync()</code> 之前数据库 crash 了，重启之后数据将会被回滚，若在 <code>fsync()</code> 之后 crash，则会进行重做操作。通过二阶段提交的方式就保证了<strong>存储引擎与二进制日志保持一致</strong>。</p>
<p>　　 </p>
<h1 id="3-三阶段提交"><a href="#3-三阶段提交" class="headerlink" title="3.三阶段提交"></a>3.三阶段提交</h1><h2 id="3-1-为什么需要三阶段提交"><a href="#3-1-为什么需要三阶段提交" class="headerlink" title="3.1 为什么需要三阶段提交"></a>3.1 为什么需要三阶段提交</h2><p>　　上面的二阶段提交是针对单一事务提交时候的操作顺序，下面我们来看看当多个事务并发的时候会是什么样的一个情况。</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/%E4%BA%8C%E9%98%B6%E6%AE%B5%E5%B9%B6%E5%8F%91.png" alt></p>
<p>　　现在有T1、T2、T3 三个事务需要执行，从图中可以看到数据在 <code>fsync()</code> 之前，三个事务已经写入到了 binlog 中，通过 <code>fsync()</code> 操作将 binlog 刷到磁盘。之后先是 T2 COMMIT，将数据更改更新到存储引擎层，接着是 T3 COMMIT，将数据更新到存储引擎层。这时候我们做了一个热备份的操作，有多种方式进行数据库的热备份，比如：XtraBackup等。这时候就会发生错误。会发生什么错误，我们需要先了解一下 XtraBackup 等热备工具的备份原理。</p>
<p>　　<strong>XtraBackup备份原理：</strong>直接拷贝数据库文件，并且记录下当前二进制日志中已经提交的最后一个事务标记。在新的数据库实例上完成 recovery 操作。</p>
<p>　　了解完备份原理之后，我们就可以想到上述情况下做热备会出现什么情况。因为 T2、T3 已经提交，所以备份的时候会记录下 T3 是最后一个提交的事务，会认为 T3 之前的事务都是已经提交的，由于是直接拷贝数据库文件，可以看到 T1 事务的数据还没有提交到存储引擎层，所以备份数据中还并没有 T1 的数据。如果新的数据库是用来做主从复制的话，change master to 会指向二进制日志中 T3 的位置，从 T3 事务开始往后进行复制，这样一来 T1 事务的数据就这样没了。产生这个问题的主要原因就是：<strong>事务写入二进制日志的顺序与事务在存储引擎层提交的顺序不一致</strong>。</p>
<p>　　为了解决这个问题，MySQL 引入了 <code>prepare_commit_mutext</code> 的机制，当事务提交的时候，需要先获得 <code>prepare_commit_mutext</code> 这个锁。有了这个锁就可以保证事务写入二进制日志的顺序与事务在存储引擎层提交的顺序一致。</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/prepare_commit_mutex.png" alt></p>
<p>　　但是这样一来，从图中我们也可以看到，原先是并发的事务，又变成了串行的，效率又变低了。只要是问题，必然存在解决方法。于是三阶段提交就出现了。</p>
<h2 id="3-2-什么是三阶段提交"><a href="#3-2-什么是三阶段提交" class="headerlink" title="3.2 什么是三阶段提交"></a>3.2 什么是三阶段提交</h2><p>　　三阶段提交，顾名思义有三个阶段： Flush 阶段、sync 阶段、commit 阶段。分别对应的就是二进制日志写内存的阶段、二进制日志刷盘的阶段、事务提交到存储引擎层的阶段。</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/%E4%B8%89%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4.png" alt></p>
<p>　　每个阶段都有 leader、follower 两种角色。当一个事务进入三个阶段中的某一个阶段，如果发现这个阶段中的队列为空，那么这个事务就会成为 leader 的角色，之后进入同一阶段的事务，发现这个阶段的队列中已经有事务存在了，那就变成 follower 角色。leader 角色的任务是安排当前阶段队列中的事务按顺序执行，并且带领队列中所有的事务进入下一个阶段。当 leader 带领队列中的事务进入下一阶段的时候，如果发现下一阶段中已经有事务存在（即下一阶段已有 leader 存在），新来的 leader 自动变成 follower 角色。</p>
<p>　　三阶段提交在每个阶段都控制了事务的顺序，从而也就控制了事务执行的整体顺序。解决了 <code>prepare_commit_mutex</code> 锁导致的问题，事务可以并发的执行。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a href="http://blog.itpub.net/28218939/viewspace-1975809/" target="_blank" rel="noopener">MySQL并发复制系列一：binlog组提交 </a></li>
<li><a href="http://blog.itpub.net/28218939/viewspace-1975822/" target="_blank" rel="noopener">MySQL并发复制系列二：多线程复制</a></li>
<li><a href="http://mysqlmusings.blogspot.jp/2012/06/binary-log-group-commit-in-mysql-56.html" target="_blank" rel="noopener">Binary Log Group Commit in MySQL 5.6</a></li>
<li>《MySQL技术内幕》</li>
</ol>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/03/Python基础之装饰器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/03/Python基础之装饰器/" class="post-title-link" itemprop="url">Python基础之装饰器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-03 10:09:21" itemprop="dateCreated datePublished" datetime="2016-12-03T10:09:21+08:00">2016-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-装饰器简介"><a href="#1-装饰器简介" class="headerlink" title="1. 装饰器简介"></a>1. 装饰器简介</h1><p>　　首先，<code>@func_decorator</code> 长成这个样子的东西，在 Python 中被称为装饰器（Decorator）。第一眼看到它，我还以为又遇到了 Java 中的注解（Annotation），有一种很熟悉的感觉。仔细了解下来，发现装饰器与注解有点类似又有点不同。</p>
<p>　　装饰器是用来修饰方法、函数或者类的，其作用是在原先的基础上完成一些额外的功能，利用装饰器来达到在不影响原先代码的情况下增加功能的需求。相比较而言，注解在 Java 中是可以用来修饰方法、函数、类和<strong>变量</strong>的，且其作用仅仅类似于注释的作用，当注解和 Java 中的反射机制结合在一起才完成了更多的功能。</p>
<p>　　下面还是如何使用装饰器吧。</p>
<h1 id="2-装饰器的分类"><a href="#2-装饰器的分类" class="headerlink" title="2. 装饰器的分类"></a>2. 装饰器的分类</h1><p>　　装饰器可以用于修饰函数和类，并且装饰器还分带参数和不带参数两种，所以我们分别来讲这几种不同的装饰器该如何编写，使用。</p>
<h2 id="2-1-修饰函数的装饰器"><a href="#2-1-修饰函数的装饰器" class="headerlink" title="2.1 修饰函数的装饰器"></a>2.1 修饰函数的装饰器</h2><h3 id="2-1-1-不带参数的装饰器"><a href="#2-1-1-不带参数的装饰器" class="headerlink" title="2.1.1 不带参数的装饰器"></a>2.1.1 不带参数的装饰器</h3><p>　　假定我们之前有这么一个函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'This is func_test() running....'</span></span><br></pre></td></tr></table></figure>
<p>　　现在，有这么一个需求过来：要求在这个函数运行开始前和运行结束后记录一下。之前的我肯定二话不说，操起键盘，上来就改成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'%s() start.'</span> %(func_test.__name__)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'This is func_test() running....'</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'%s() finish.'</span> %(func_test.__name__)</span><br></pre></td></tr></table></figure>
<p>　　但是如果我用装饰器我可以怎么写呢。</p>
<p>　　首先，使用装饰器之前需要先定义装饰器，Python 定义装饰器和定义函数式一样的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kw)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'%s() start.'</span> %(func.__name__)</span><br><span class="line">        func(*args,**kw)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'%s() finish.'</span> %(func.__name__)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
<p>　　然后怎么使用这和装饰器呢，很简单：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@func_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'This is func_test() running....'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	func_test()</span><br></pre></td></tr></table></figure>
<p>　　就是在原先的基础上增加了一行代码，做到的效果和我原先更改两行代码的效果是一样的。</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/func_decorator_without_args.PNG" alt></p>
<p>　　在回过头来看一下 <code>func_decorator</code> 的代码，其实不难理解，因为 Python 一切都是对象，所以装饰器，把函数 <code>func_test</code> 当成一个参数传入一个新的函数中，在新的函数 <code>wrapper</code> 中增加我们所需要的功能，最后将这个经过<strong>装饰</strong>的函数返回，使其替代原先的函数。</p>
<h3 id="2-1-2-带参数的装饰器"><a href="#2-1-2-带参数的装饰器" class="headerlink" title="2.1.2 带参数的装饰器"></a>2.1.2 带参数的装饰器</h3><p>　　有了不带参数的装饰器的基础，带参数的装饰器就比较容易理解了。我们看到装饰器的定义和函数的定义没有什么区别，我们可以向函数传递参数，那么我们也可以向装饰器传递参数。假定我们现在还是原来那个函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'This is func_test() running....'</span></span><br></pre></td></tr></table></figure>
<p>　　新的需求是：输出函数使用对象。</p>
<p>　　我们可以定义这样一个装饰器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_decorator_with_args</span><span class="params">(user)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kw)</span>:</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">'The user of func is %s'</span> %(user)</span><br><span class="line">            <span class="keyword">return</span> func(*args,**kw)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br></pre></td></tr></table></figure>
<p>　　然后使用这个装饰器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@func_decorator_with_args('sg')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'This is func_test() running....'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	func_test()</span><br></pre></td></tr></table></figure>
<p>　　结果如下：</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/func_decorator_with_args.PNG" alt></p>
<p>　　给定义带参数的装饰器的时候也可以向函数一样指定默认值。</p>
<h2 id="2-2-修饰类的装饰器"><a href="#2-2-修饰类的装饰器" class="headerlink" title="2.2 修饰类的装饰器"></a>2.2 修饰类的装饰器</h2><p>　　看过用来修饰函数的装饰器，我们再来看看修饰类的装饰器。修饰函数的装饰器是将原函数包装成一个新的函数并且返回，修饰类的装饰器也是一样的道理，是将原先的类包装成一个新的类并且返回。</p>
<p>　　假设我们有这么一个类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,age,name)</span>:</span></span><br><span class="line">        self.age = age</span><br><span class="line">        self.name = name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Age:%d Name:%s'</span> %(self.age,self.name)</span><br></pre></td></tr></table></figure>
<p>　　需求是在每次调用 <code>show()</code> 函数的时候，记录这个函数一共被调用了几次。</p>
<p>　　我们定义了这么一个装饰器，并使用这个装饰器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">class_decorator</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">NewClass</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,age,name)</span>:</span></span><br><span class="line">            self.show_count = <span class="number">0</span></span><br><span class="line">            self.wrapped = a(age,name)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">            self.show_count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">'Call show() %d '</span> %(self.show_count)</span><br><span class="line">            self.wrapped.show()</span><br><span class="line">    <span class="keyword">return</span> NewClass</span><br><span class="line"></span><br><span class="line"><span class="meta">@class_decorator</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,age,name)</span>:</span></span><br><span class="line">        self.age = age</span><br><span class="line">        self.name = name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Age:%d Name:%s'</span> %(self.age,self.name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p = People(<span class="number">22</span>,<span class="string">'sg'</span>)</span><br><span class="line">    p.show()</span><br><span class="line">    p.show()</span><br></pre></td></tr></table></figure>
<p>　　可以得到结果：</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/class_decorator.PNG" alt></p>
<p>　　可以看到 <code>class_decorator</code> 这装饰器是创建了一个 <code>NewClass</code> 来替代被装饰的类，比较重要的点就是，调用被装饰类的 <code>init()</code> 方法来获得被装饰类的一个对象，并用这个对象完成对原先方法的调用。</p>
<h1 id="3-装饰器的用途"><a href="#3-装饰器的用途" class="headerlink" title="3. 装饰器的用途"></a>3. 装饰器的用途</h1><p>　　装饰器的作用和设计模式中的装饰模式吻合，在尽量保持原代码不动的情况下增加程序的功能。但是从我目前的感觉来说，Pyhton 的装饰器用于修饰函数还是可以的，但是用于修饰类的装饰器，我觉得并不方便，因为装饰器的代码完全需要依赖于原先的类的定义，我定义一个装饰器，我还不如重新定义一个类来继承原类。</p>
<p>　　总结来说，我知道装饰器该怎么用了，但是用在哪，怎么<strong>用好</strong>装饰器，我任然需要学习。</p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/07/MySQL 主从环境配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/pig.jpeg">
      <meta itemprop="name" content="Win-Man">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Win-Man's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/11/07/MySQL 主从环境配置/" class="post-title-link" itemprop="url">MySQL 主从环境配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-11-07 20:46:25" itemprop="dateCreated datePublished" datetime="2016-11-07T20:46:25+08:00">2016-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-26 14:42:58" itemprop="dateModified" datetime="2021-05-26T14:42:58+08:00">2021-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h1><p>　　</p>
<h1 id="2-环境"><a href="#2-环境" class="headerlink" title="2.环境"></a>2.环境</h1><blockquote>
<p>操作系统： CentOS6.5<br>MySQL：mysql-5.6.34</p>
</blockquote>
<h1 id="3-二进制包方式安装-MySQL"><a href="#3-二进制包方式安装-MySQL" class="headerlink" title="3.二进制包方式安装 MySQL"></a>3.二进制包方式安装 MySQL</h1><h2 id="3-1-卸载-Linux-自带的-MySQL"><a href="#3-1-卸载-Linux-自带的-MySQL" class="headerlink" title="3.1 卸载 Linux 自带的 MySQL"></a>3.1 卸载 Linux 自带的 MySQL</h2><p>Linux 系统自带了 MySQL 数据库，但是对于我们来说版本低了点，所以我们还是自己重新安装一遍 MySQL，为防止冲突，我们需要将原先版本的 MySQL 卸载。</p>
<ol>
<li>查看 MySQL 及相关的 RPM 包</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep -i mysql</span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/%E6%9F%A5%E8%AF%A2%E8%87%AA%E5%B8%A6mysql.PNG" alt></p>
<ol start="2">
<li>卸载 MySQL</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove mysql<span class="number">-5.1</span><span class="number">.71</span><span class="number">-1.</span>el6</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>查看是否卸载</li>
</ol>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/%E5%8D%B8%E8%BD%BDmysql%E5%90%8E.PNG" alt></p>
<h2 id="3-2-安装-MySQL"><a href="#3-2-安装-MySQL" class="headerlink" title="3.2 安装 MySQL"></a>3.2 安装 MySQL</h2><ol>
<li>下载 MySQL</li>
</ol>
<p>通过 <code>wget</code> 命令下载 MySQL 的 tar.gz 文件</p>
<ol start="2">
<li>解压 tar.gz 文件</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">tar zxvf &#123;下载文件所在路径&#125;.tar.gz</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>重名文件夹</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv mysql<span class="number">-5.6</span><span class="number">.34</span>-linux-glibc2<span class="number">.5</span>-i686/ mysql</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>更改 mysql 文件夹属性</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd mysql/</span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql</span><br><span class="line">chown -R mysql .</span><br><span class="line">chgrp -R mysql .</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> 编译安装 MySQL</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line">scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql/ --datadir=/usr/local/mysql/data/</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>配置 my.cnf 文件</li>
</ol>
<p>从 mysql 安装目录下拷贝一份 my.cnf 文件到 /etc/ 目录下，如果原先 /etc/ 存在 my.cnf 文件，则覆盖。</p>
<p>在 <code>[mysqld]</code>中添加：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">basedir = /usr/local/mysql</span><br><span class="line">datadir = /usr/local/mysql/data</span><br><span class="line">port = <span class="number">3306</span></span><br><span class="line">server_id = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<ol start="7">
<li>启动 MySQL 服务</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">ln -s /usr/local/mysql/bin/mysql /usr/bin</span><br><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
<ol start="8">
<li>验证 MySQL 服务是否开启</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep mysqld</span><br></pre></td></tr></table></figure>
<h1 id="4-配置主从环境"><a href="#4-配置主从环境" class="headerlink" title="4.配置主从环境"></a>4.配置主从环境</h1><h2 id="4-1-准备两台-Linux-环境服务器"><a href="#4-1-准备两台-Linux-环境服务器" class="headerlink" title="4.1 准备两台 Linux 环境服务器"></a>4.1 准备两台 Linux 环境服务器</h2><p>分别在两台服务器上按上述步骤安装 MySQL。</p>
<h2 id="4-2-配置主库"><a href="#4-2-配置主库" class="headerlink" title="4.2 配置主库"></a>4.2 配置主库</h2><ol>
<li>修改主库所在服务器上的 my.cnf 文件</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br></pre></td></tr></table></figure>
<p>在 my.cnf 文件中添加</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_bin = master_mysql_bin</span><br></pre></td></tr></table></figure>
<p>该参数配置表示开启 MySQL 的二进制日志。</p>
<ol start="2">
<li>重启 MySQL 服务</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>查看 master 节点状态</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br></pre></td></tr></table></figure>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/master_status.PNG" alt></p>
<p>记录下红色标记处的信息，配置 slave 节点时需要。</p>
<ol start="4">
<li>主库中增加复制账号</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant replication slave on *.* to 'repl'@'192.168.222.%' identified by 'replsafe';</span><br></pre></td></tr></table></figure>
<h2 id="4-3-配置从库"><a href="#4-3-配置从库" class="headerlink" title="4.3 配置从库"></a>4.3 配置从库</h2><ol>
<li>修改从库所在服务器上的 my.cnf 文件</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br></pre></td></tr></table></figure>
<p>在 my.cnf 文件中添加</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log_bin = slave_mysql_bin</span><br><span class="line">relay_log = mysql_relay_bin</span><br></pre></td></tr></table></figure>
<p>修改从库上的二进制日志和中继日志的命名规则</p>
<ol start="2">
<li>重启 MySQL 服务</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>连接到主库</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; change master to</span><br><span class="line">    -&gt; master_host='192.168.222.131',</span><br><span class="line">    -&gt; master_port=<span class="number">3306</span>,</span><br><span class="line">    -&gt; master_user='repl',</span><br><span class="line">    -&gt; master_password='replsafe',</span><br><span class="line">    -&gt; master_log_file='master_mysql_bin.000001',</span><br><span class="line">    -&gt; master_log_pos=<span class="number">120</span>;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected, <span class="number">2</span> warnings (<span class="number">0.11</span> sec)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>开启复制</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>查看从库复制状态</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** <span class="number">1.</span> row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: <span class="number">192.168</span><span class="number">.222</span><span class="number">.131</span></span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: master_mysql_bin<span class="number">.000001</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">330</span></span><br><span class="line">               Relay_Log_File: mysql_relay_bin<span class="number">.000002</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">500</span></span><br><span class="line">        Relay_Master_Log_File: master_mysql_bin<span class="number">.000001</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: <span class="number">0</span></span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: <span class="number">0</span></span><br><span class="line">          Exec_Master_Log_Pos: <span class="number">330</span></span><br><span class="line">              Relay_Log_Space: <span class="number">673</span></span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: <span class="number">0</span></span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: <span class="number">0</span></span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: <span class="number">0</span></span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: <span class="number">131</span></span><br><span class="line">                  Master_UUID: <span class="number">249f</span>7c7a<span class="number">-9b</span>c8<span class="number">-11e6</span><span class="number">-8</span>aaf<span class="number">-000</span>c29b971bb</span><br><span class="line">             Master_Info_File: /usr/local/mysql/data/master.info</span><br><span class="line">                    SQL_Delay: <span class="number">0</span></span><br><span class="line">          SQL_Remaining_Delay: <span class="literal">NULL</span></span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay <span class="built_in">log</span>; waiting <span class="keyword">for</span> the slave I/O thread to update it</span><br><span class="line">           Master_Retry_Count: <span class="number">86400</span></span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: <span class="number">0</span></span><br><span class="line"><span class="number">1</span> <span class="function">row in <span class="title">set</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br></pre></td></tr></table></figure>
<p>通过 <code>show slave status\G</code> 显示出来的内容如上，则表示主备环境搭建成功。</p>
<ol start="6">
<li>验证复制功能</li>
</ol>
<p>在主库上创建一个数据库，创建一张表，并想表中插入数据，查看从库能否有相同数据。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database master_slave;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="function">row <span class="title">affected</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">mysql&gt; use master_slave</span>;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; <span class="function">create table <span class="title">tb1</span><span class="params">(id <span class="keyword">int</span>)</span></span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="function">rows <span class="title">affected</span> <span class="params">(<span class="number">0.14</span> sec)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">mysql&gt; insert into tb1 <span class="title">values</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="function">row <span class="title">affected</span> <span class="params">(<span class="number">0.03</span> sec)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">mysql&gt; select * from tb1</span>;</span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">|    <span class="number">1</span> |</span><br><span class="line">+------+</span><br><span class="line"><span class="number">1</span> <span class="function">row in <span class="title">set</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br></pre></td></tr></table></figure>
<p>查看从库上是否有相同数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| master_slave       |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line"><span class="number">5</span> <span class="function">rows in <span class="title">set</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">mysql&gt; use master_slave</span>;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table <span class="keyword">and</span> column names</span><br><span class="line">You can turn off <span class="keyword">this</span> feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+------------------------+</span><br><span class="line">| Tables_in_master_slave |</span><br><span class="line">+------------------------+</span><br><span class="line">| tb1                    |</span><br><span class="line">+------------------------+</span><br><span class="line"><span class="number">1</span> <span class="function">row in <span class="title">set</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">mysql&gt; select * from tb1</span>;</span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">|    <span class="number">1</span> |</span><br><span class="line">+------+</span><br><span class="line"><span class="number">1</span> <span class="function">row in <span class="title">set</span> <span class="params">(<span class="number">0.00</span> sec)</span></span></span><br></pre></td></tr></table></figure>
<p>验证复制功能成功。</p>
<h1 id="5-可能遇到的问题"><a href="#5-可能遇到的问题" class="headerlink" title="5.可能遇到的问题"></a>5.可能遇到的问题</h1><p><strong>问题一：</strong><br>在启动复制功能时，查看 slave 节点状态发现：</p>
<p><img src="http://oc4wmeyj8.bkt.clouddn.com/2003%E9%94%99%E8%AF%AF.PNG" alt></p>
<p><strong>原因：</strong>主库服务器上防火墙开启导致，从库连接不上主库</p>
<p><strong>解决方案：</strong>在主库服务器上关闭防火墙 <code>service iptables stop</code></p>
<blockquote>
<p>博客地址：<a href="https://win-man.github.io/" target="_blank" rel="noopener">https://win-man.github.io/</a><br>公众号：欢迎关注  </p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2018/8/16/165435ce71d2b88b?w=258&amp;h=258&amp;f=jpeg&amp;s=26568" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Win-Man"
      src="/images/pig.jpeg">
  <p class="site-author-name" itemprop="name">Win-Man</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Win-Man" title="GitHub → https://github.com/Win-Man" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:gang.shen0423@gmail.com" title="E-Mail → mailto:gang.shen0423@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/2855803080" title="Weibo → https://weibo.com/2855803080" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://blog.csdn.net/win_man" title="http://blog.csdn.net/win_man" rel="noopener" target="_blank">CSDN博客</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Win-Man</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        


  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1260159928&web_id=1260159928"></script>
  </div>






      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
